var K=Object.defineProperty;var v=r=>{throw TypeError(r)};var $=(r,e,t)=>e in r?K(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var s=(r,e,t)=>$(r,typeof e!="symbol"?e+"":e,t),B=(r,e,t)=>e.has(r)||v("Cannot "+t);var D=(r,e,t)=>e.has(r)?v("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t);var b=(r,e,t)=>(B(r,e,"access private method"),t);const P="dice-stats",q=P,C=11;var U=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.D2=1]="D2",r[r.D3=2]="D3",r[r.D4=3]="D4",r[r.D6=4]="D6",r[r.D8=5]="D8",r[r.D10=6]="D10",r[r.D12=7]="D12",r[r.D20=8]="D20",r[r.D50=9]="D50",r[r.D100=10]="D100",r[r.LENGTH=11]="LENGTH",r))(U||{}),n=(r=>(r[r.UNKNOWN=0]="UNKNOWN",r[r.DESCENDING=1]="DESCENDING",r[r.ASCENDING=2]="ASCENDING",r[r.LENGTH=3]="LENGTH",r))(n||{});class G{static getDieMax(e){switch(e){case 1:return 2;case 2:return 3;case 3:return 4;case 4:return 6;case 5:return 8;case 6:return 10;case 7:return 12;case 8:return 20;case 9:return 50;case 10:return 100;default:return 0}}static getDieAverage(e){switch(e){case 1:return 1.5;case 2:return 2;case 3:return 2.5;case 4:return 3.5;case 5:return 4.5;case 6:return 5.5;case 7:return 6.5;case 8:return 10.5;case 9:return 25.5;case 10:return 50.5;default:return 0}}static dsLogError(e){console.log("DICE-STATS ERROR: "+e)}}class N{constructor(e){s(this,"type",U.UNKNOWN);s(this,"max",0);s(this,"rolledValue",-1);s(this,"totalRolls",0);s(this,"rolls",[]);s(this,"mean",0);s(this,"median",0);s(this,"mode",0);s(this,"streakDir",n.UNKNOWN);s(this,"streakSize",-1);s(this,"streakInit",-1);s(this,"longestStreakDir",n.UNKNOWN);s(this,"longestStreakSize",-1);s(this,"longestStreakInit",-1);this.type=e,this.max=G.getDieMax(e),this.rolls=new Array(this.max+1),this.clear()}clear(){this.totalRolls=0,this.rolls.fill(0),this.mean=0,this.median=0,this.mode=0,this.streakDir=n.UNKNOWN,this.streakSize=-1,this.streakInit=-1,this.longestStreakDir=n.UNKNOWN,this.longestStreakSize=-1,this.longestStreakInit=-1}addDieInfo(e,t=!1,a=!1){if(a&&e.type==this.type&&e.rolledValue>-1&&e.rolledValue<=this.max)this.addNewRoll(e.rolledValue);else if(e.type==this.type&&e.max==this.max){this.totalRolls+=e.totalRolls;for(var i=0;i<this.max;i++)this.rolls[i]+=e.rolls[i];t&&(e.streakSize>this.streakSize&&(this.streakDir=e.streakDir,this.streakInit=e.streakInit,this.streakSize=e.streakSize),e.longestStreakSize>this.longestStreakSize&&(this.longestStreakSize=e.longestStreakSize,this.longestStreakSize=e.longestStreakSize,this.longestStreakSize=e.longestStreakSize))}else G.dsLogError("Failed to add "+e+" to "+this)}addNewRoll(e){this.rolls[e]++,this.streakSize<1?(this.streakSize=1,this.streakInit=e,this.streakDir=n.UNKNOWN):((this.streakDir==n.UNKNOWN||this.streakDir==n.ASCENDING)&&e==this.streakInit+this.streakSize?(this.streakDir=n.ASCENDING,this.streakSize++):(this.streakDir==n.UNKNOWN||this.streakDir==n.DESCENDING)&&e==this.streakInit-this.streakSize?(this.streakDir=n.DESCENDING,this.streakSize++):(this.streakDir=n.UNKNOWN,this.streakSize=1,this.streakInit=e),this.streakSize>this.longestStreakSize&&(this.longestStreakDir=this.streakDir,this.longestStreakInit=this.streakInit,this.longestStreakSize=this.streakSize))}calculateTotalRolls(){var e=0;for(let t of this.rolls)e+=t;return e}calculateMean(){if(!this.rolls||this.rolls.length==0)return 0;var e=0,t=0;for(let a=0;a<this.rolls.length;a++)e+=this.rolls[a],t=t+(a+1)*this.rolls[a];return e>0?(t/e).toFixed(2):0}calculateMedian(){if(!this.rolls||this.rolls.length==0)return 0;let e=0;for(let a=0;a<this.rolls.length;a++)e+=this.rolls[a];if(e>1){let a=0;e%2===0?a=Math.floor(e/2):a=Math.floor(e/2)+1;for(let i=0;i<this.rolls.length;i++){for(var t=this.rolls[i];t!=0&&a!=0;)a--,t--;if(a===0)return i+1}}else if(e===1){for(let a=0;a<this.rolls.length;a++)if(this.rolls[a]===1)return a+1}return 0}calculateMode(){if(!this.rolls||this.rolls.length==0)return 0;var e=0,t=0;for(let a=0;a<this.rolls.length;a++)this.rolls[a]>t&&(e=a,t=this.rolls[a]);return e+1}static createDieInfoAry(){for(var e=new Array(C),t=0;t<C;t++)e[t]=new N(t);return e}}class I{constructor(){s(this,"DEGREE_SUCCESS",{});s(this,"system_id","")}getDisplayData(){}addSystemData(e){}parseRollMessage(e){}clear(){}}class A{static createSystemData(e){switch(e){case"pf2e":return new I;default:return new I}}}const{ApplicationV2:j,DocumentSheetV2:se,HandlebarsApplicationMixin:J}=foundry.applications.api;var S,R;const c=class c extends J(j){constructor(t="",a={}){super(a);s(this,"associatedPlayerId","");this.associatedPlayerId=t}get title(){return"My Module: Dice Stats Module"}async _prepareContext(t){let a={tabGroups:{primary:""}};return a.tabGroups.primary==""&&a.tabGroups.primary=="genericData",a.tabs={genericData:{cssClass:a.tabGroups.primary==="genericData"?"active":"",group:"primary",id:"genericData",icon:"fa-solid fa-dice-d20",label:"Dice Data - Label",title:"Dice Data",genericData:{}},systemCharts:{cssClass:a.tabGroups.primary==="systemCharts"?"active":"",group:"primary",id:"systemCharts",icon:"fa-solid fa-hands-holding-circle",label:"System Chart Data - Label",systemCharts:{}},systemDetails:{cssClass:a.tabGroups.primary==="systemDetails"?"active":"",group:"primary",id:"systemDetails",icon:"fa-solid fa-pen-to-square",label:"System Details Data - Label",systemDetails:{}}},a}_configureRenderOptions(t){super._configureRenderOptions(t),t.parts=["tabs","genericData","systemCharts","systemDetails"]}_onRender(t,a){var i;(i=this.element.querySelector("input[name=gen-btn]"))==null||i.addEventListener("click",c.refresh)}static async refresh(){await console.log("Dice Stats GenericApp On Refresh")}};S=new WeakSet,R=async function(t,a,i){console.log("Dice Stats GenericApp On Submit!")},D(c,S),s(c,"templates",{genericDataTab:"modules/dice-stats/templates/player-data/tabs/generic-dice-data-tab.hbs",systemChartTab:"modules/dice-stats/templates/player-data/tabs/systemForms/unknown/unknown-system-chart-form.hbs",systemDetailsTab:"modules/dice-stats/templates/player-data/tabs/systemForms/unknown/unknown-system-data-form.hbs"}),s(c,"DEFAULT_OPTIONS",{tag:"form",form:{handler:b(c,S,R),submitOnChange:!1,closeOnSubmit:!1},position:{width:600,height:400}}),s(c,"PARTS",{tabs:{template:"modules/dice-stats/templates/player-data/player-data-nav-form.hbs"},genericData:{template:c.templates.genericDataTab,scrollable:[""]},systemCharts:{template:c.templates.systemChartTab,scrollable:[""]},systemDetails:{template:c.templates.systemDetailsTab,scrollable:[""]}});let f=c;class Q{constructor(e,t,a,i){s(this,"_userId","");s(this,"_userName","");s(this,"_isGm",!1);s(this,"_playerForm");s(this,"_diceInfo");s(this,"_systemInfo");this._userId=e,this._userName=t,this._isGm=a,this._diceInfo=N.createDieInfoAry(),this._systemInfo=A.createSystemData(i),this._playerForm=new f(e,{})}getUsername(){return this._userName}getUserID(){return this._userId}getIsGm(){return this._isGm}setUsername(e){this._userName=e}setUserID(e){this._userId=e}setIsGm(e){this._isGm=e}addGenericInfo(e){for(let t of e)this._diceInfo[t.type].addDieInfo(t)}addSystemInfo(e){e&&this._systemInfo.addSystemData(e)}clearAllData(){this.clearAllDiceData(),this._systemInfo.clear()}clearSystemData(){this._systemInfo.clear()}addSystemData(e){this._systemInfo.addSystemData(e)}clearAllDiceData(){for(let e of this._diceInfo)e.clear()}clearDieData(e){var t;(t=this._diceInfo[e])==null||t.clear()}addDieData(e){this._diceInfo[e.type].addDieInfo(e)}addRollData(e,t){this._diceInfo[t].addNewRoll(e)}openPlayerForm(){this._playerForm.render(!0)}}const{ApplicationV2:X,DocumentSheetV2:ae,HandlebarsApplicationMixin:Z}=foundry.applications.api;var p,W;const d=class d extends Z(X){constructor(e={}){super(e)}get title(){return"My Module: Dice Stats Module"}async _prepareContext(e){const t={};return t.customHeading="WOJO's Custom Heading",t}_onRender(e,t){var a;(a=this.element.querySelector("input[name=GenBtn]"))==null||a.addEventListener("click",d.refresh)}static async refresh(){await console.log("Dice Stats GenericApp On Refresh")}};p=new WeakSet,W=async function(e,t,a){console.log("Dice Stats GenericApp On Submit!")},D(d,p),s(d,"DEFAULT_OPTIONS",{tag:"form",form:{handler:b(d,p,W),submitOnChange:!1,closeOnSubmit:!1},position:{width:600,height:400}}),s(d,"PARTS",{form:{template:"modules/dice-stats/templates/genericTemplate.hbs"}});let g=d;class T{static parseMessageData(e){return[]}}const m=class m{constructor(){s(this,"_isPaused",!1);s(this,"_settingsForm");s(this,"_globalForm");s(this,"_compareForm");s(this,"diceStatsPlayerMap",new Map);H.registerSettings(),this._settingsForm=new g,this._globalForm=new g,this._compareForm=new g}static getInstance(){return(!m._instance||m._instance==null)&&(m._instance=new m),m._instance}loadPlayers(){let e=game==null?void 0:game.users,t=game.system.id;if(e)for(var a of e){let i=new Q(a._id,a.name,a.isGM,t);this.diceStatsPlayerMap.set(a.name,i),this.diceStatsPlayerMap.set(a._id,i)}}setSystemTemplates(e,t){f.templates.systemChartTab=e,f.templates.systemDetailsTab=t}parseRollMessage(e){if(this._isPaused||!e.isRoll)return;let t=e.author.id,a=this.diceStatsPlayerMap.get(t),l=A.createSystemData(game.system.id).parseRollMessage(e),o=T.parseMessageData(e);a&&(a.addGenericInfo(o),a.addSystemInfo(l)),this.saveDataToDB()}openSettingsForm(e=!1){var t;(t=this._settingsForm)==null||t.render(!0)}openGlobalForm(e=!1){var t;(t=this._globalForm)==null||t.render(!0)}openCompareForm(e=!1){var t;(t=this._compareForm)==null||t.render(!0)}openPlayerForm(e="",t="",a=!1){var i,l;e?(i=this.diceStatsPlayerMap.get(e))==null||i.openPlayerForm():t&&((l=this.diceStatsPlayerMap.get(t))==null||l.openPlayerForm())}changePauseState(e=!1){return this._isPaused=!this._isPaused,this._isPaused}getIsPaused(){return this._isPaused}saveRollValue(e,t,a){if(!this._isPaused){var i=this.diceStatsPlayerMap.get(e);i==null||i.addRollData(a,t)}}saveDataToDB(){}};s(m,"_instance"),s(m,"id","dice-stats");let h=m;class H{static registerSettings(){if(this.settingsRegisterd!=!0){this.settingsRegisterd=!0;var e="players_see_gm";game.settings.register(h.id,e,{name:`DiceStats.Settings.${e}.Name`,default:!1,type:Boolean,scope:"world",config:!0,hint:`DiceStats.Settings.${e}.Hint`})}}}s(H,"settingsRegisterd",!1);var w,z;class Y{constructor(){s(this,"name",((w=game.i18n)==null?void 0:w.localize("DiceStats.SceneControls.Settings.Name"))??"");s(this,"title",((z=game.i18n)==null?void 0:z.localize("DiceStats.SceneControls.Settings.Title"))??"");s(this,"icon","fa-solid fa-gears");s(this,"order",0);s(this,"visible",!0);s(this,"active",!1);s(this,"button",!0)}async onChange(e,t){h.getInstance().openSettingsForm(!0),new g().render()}}var M,x;class _{constructor(){s(this,"active",!1);s(this,"button",!0);s(this,"name",((M=game.i18n)==null?void 0:M.localize("DiceStats.SceneControls.GlobalStats.Name"))??"");s(this,"title",((x=game.i18n)==null?void 0:x.localize("DiceStats.SceneControls.GlobalStats.Title"))??"");s(this,"icon","fa-solid fa-earth-americas");s(this,"order",0);s(this,"visible",!0)}async onChange(e,t){h.getInstance().openGlobalForm()}}var O,F;class E{constructor(){s(this,"active",!1);s(this,"button",!0);s(this,"name",((O=game.i18n)==null?void 0:O.localize("DiceStats.SceneControls.CompareStats.Name"))??"");s(this,"title",((F=game.i18n)==null?void 0:F.localize("DiceStats.SceneControls.CompareStats.Title"))??"");s(this,"icon","fa-solid fa-users-line");s(this,"order",0);s(this,"visible",!0)}async onChange(e,t){h.getInstance().openCompareForm()}}const u=class u{constructor(e,t,a){s(this,"active",!1);s(this,"button",!0);s(this,"icon","");s(this,"name","");s(this,"order",0);s(this,"title","");s(this,"visible",!0);s(this,"associatedPlayerId","");var l,o;var i=((o=(l=game==null?void 0:game.users)==null?void 0:l.get(t))==null?void 0:o.isGM)??!1;this.name=e+"_name",this.title=e,this.associatedPlayerId=t,i?this.icon="fa-solid fa-book-open-reader":a?this.icon=a:this.icon="fas fa-dice-d20"}async onChange(e,t){u.app==null&&(u.app=new f),u.app.render(!0)}};s(u,"app");let k=u;class ee extends SceneControls{constructor(t){super();s(this,"icon","fas fa-dice-d20");s(this,"name","dice-stats");s(this,"layer","diceStats");s(this,"visible",!0);s(this,"tools",{});s(this,"order",69);var a=0,i=new Y;i.order=++a,this.tools[i.name]=i;var l=new _;l.order=++a,this.tools[l.name]=l;var o=new E;o.order=++a,this.tools[o.name]=o;for(var[L,V]of t){var y=new k(V,L,"fas fa-dice-d20");y.order=++a,this.tools[y.name]=y}}async onChange(t,a){}get title(){var t;return((t=game.i18n)==null?void 0:t.localize("DiceStats.SceneControls.DiceStatsSceneControl.Title"))??"Dice Stats"}get activeTool(){return""}}Hooks.once("init",()=>{console.log(`Initializing ${q}`),h.getInstance()});Hooks.once("ready",()=>{console.log("Scene Ready, We can load player data now!"),h.getInstance().loadPlayers()});Hooks.on("getSceneControlButtons",r=>{let e=[],t=["",""],a=game.users;if(a)for(let o of a)t[0]=o._id,t[1]=o.name,e.push(t);var i=new ee(e);let l="dice-stats";r[l]=i});
//# sourceMappingURL=module.js.map
