var W=Object.defineProperty;var N=a=>{throw TypeError(a)};var A=(a,e,t)=>e in a?W(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var s=(a,e,t)=>A(a,typeof e!="symbol"?e+"":e,t),H=(a,e,t)=>e.has(a)||N("Cannot "+t);var D=(a,e,t)=>e.has(a)?N("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t);var k=(a,e,t)=>(H(a,e,"access private method"),t);const R="dice-stats",L=R,y=11;var I=(a=>(a[a.UNKNOWN=0]="UNKNOWN",a[a.D2=1]="D2",a[a.D3=2]="D3",a[a.D4=3]="D4",a[a.D6=4]="D6",a[a.D8=5]="D8",a[a.D10=6]="D10",a[a.D12=7]="D12",a[a.D20=8]="D20",a[a.D50=9]="D50",a[a.D100=10]="D100",a[a.LENGTH=11]="LENGTH",a))(I||{}),o=(a=>(a[a.UNKNOWN=0]="UNKNOWN",a[a.DESCENDING=1]="DESCENDING",a[a.ASCENDING=2]="ASCENDING",a[a.LENGTH=3]="LENGTH",a))(o||{});class v{static getDieMax(e){switch(e){case 1:return 2;case 2:return 3;case 3:return 4;case 4:return 6;case 5:return 8;case 6:return 10;case 7:return 12;case 8:return 20;case 9:return 50;case 10:return 100;default:return 0}}static getDieAverage(e){switch(e){case 1:return 1.5;case 2:return 2;case 3:return 2.5;case 4:return 3.5;case 5:return 4.5;case 6:return 5.5;case 7:return 6.5;case 8:return 10.5;case 9:return 25.5;case 10:return 50.5;default:return 0}}static dsLogError(e){console.log("DICE-STATS ERROR: "+e)}}class p{constructor(e){s(this,"type",I.UNKNOWN);s(this,"max",0);s(this,"rolledValue",-1);s(this,"totalRolls",0);s(this,"rolls",[]);s(this,"mean",0);s(this,"median",0);s(this,"mode",0);s(this,"streakDir",o.UNKNOWN);s(this,"streakSize",-1);s(this,"streakInit",-1);s(this,"longestStreakDir",o.UNKNOWN);s(this,"longestStreakSize",-1);s(this,"longestStreakInit",-1);this.type=e,this.max=v.getDieMax(e),this.rolls=new Array(this.max+1),this.clear()}clear(){this.totalRolls=0,this.rolls.fill(0),this.mean=0,this.median=0,this.mode=0,this.streakDir=o.UNKNOWN,this.streakSize=-1,this.streakInit=-1,this.longestStreakDir=o.UNKNOWN,this.longestStreakSize=-1,this.longestStreakInit=-1}addDieInfo(e,t=!1,r=!1){if(r&&e.type==this.type&&e.rolledValue>-1&&e.rolledValue<=this.max)this.addNewRoll(e.rolledValue);else if(e.type==this.type&&e.max==this.max){this.totalRolls+=e.totalRolls;for(var i=0;i<this.max;i++)this.rolls[i]+=e.rolls[i];t&&(e.streakSize>this.streakSize&&(this.streakDir=e.streakDir,this.streakInit=e.streakInit,this.streakSize=e.streakSize),e.longestStreakSize>this.longestStreakSize&&(this.longestStreakSize=e.longestStreakSize,this.longestStreakSize=e.longestStreakSize,this.longestStreakSize=e.longestStreakSize))}else v.dsLogError("Failed to add "+e+" to "+this)}addNewRoll(e){this.rolls[e]++,this.streakSize<1?(this.streakSize=1,this.streakInit=e,this.streakDir=o.UNKNOWN):((this.streakDir==o.UNKNOWN||this.streakDir==o.ASCENDING)&&e==this.streakInit+this.streakSize?(this.streakDir=o.ASCENDING,this.streakSize++):(this.streakDir==o.UNKNOWN||this.streakDir==o.DESCENDING)&&e==this.streakInit-this.streakSize?(this.streakDir=o.DESCENDING,this.streakSize++):(this.streakDir=o.UNKNOWN,this.streakSize=1,this.streakInit=e),this.streakSize>this.longestStreakSize&&(this.longestStreakDir=this.streakDir,this.longestStreakInit=this.streakInit,this.longestStreakSize=this.streakSize))}calculateTotalRolls(){var e=0;for(let t of this.rolls)e+=t;return e}calculateMean(){if(!this.rolls||this.rolls.length==0)return 0;var e=0,t=0;for(let r=0;r<this.rolls.length;r++)e+=this.rolls[r],t=t+(r+1)*this.rolls[r];return e>0?(t/e).toFixed(2):0}calculateMedian(){if(!this.rolls||this.rolls.length==0)return 0;let e=0;for(let r=0;r<this.rolls.length;r++)e+=this.rolls[r];if(e>1){let r=0;e%2===0?r=Math.floor(e/2):r=Math.floor(e/2)+1;for(let i=0;i<this.rolls.length;i++){for(var t=this.rolls[i];t!=0&&r!=0;)r--,t--;if(r===0)return i+1}}else if(e===1){for(let r=0;r<this.rolls.length;r++)if(this.rolls[r]===1)return r+1}return 0}calculateMode(){if(!this.rolls||this.rolls.length==0)return 0;var e=0,t=0;for(let r=0;r<this.rolls.length;r++)this.rolls[r]>t&&(e=r,t=this.rolls[r]);return e+1}static createDieInfoAry(){for(var e=new Array(y),t=0;t<y;t++)e[t]=new p(t);return e}}class z{constructor(){s(this,"DEGREE_SUCCESS",{});s(this,"system_id","")}getDisplayData(){}addSystemData(e){}parseRollMessage(e){}clear(){}}class K{static createSystemData(e){switch(e){case"pf2e":return new z;default:return new z}}}class V{constructor(e,t,r,i){s(this,"_userId","");s(this,"_userName","");s(this,"_isGm",!1);s(this,"_playerForm",0);s(this,"_diceInfo");s(this,"_systemInfo");this._userId=e,this._userName=t,this._isGm=r,this._diceInfo=p.createDieInfoAry(),this._systemInfo=K.createSystemData(i)}getUsername(){return this._userName}getUserID(){return this._userId}getIsGm(){return this._isGm}setUsername(e){this._userName=e}setUserID(e){this._userId=e}setIsGm(e){this._isGm=e}clearAllData(){this.clearAllDiceData(),this._systemInfo.clear()}clearSystemData(){this._systemInfo.clear()}addSystemData(e){this._systemInfo.addSystemData(e)}clearAllDiceData(){for(let e of this._diceInfo)e.clear()}clearDieData(e){var t;(t=this._diceInfo[e])==null||t.clear()}addDieData(e){this._diceInfo[e.type].addDieInfo(e)}addRollData(e,t){this._diceInfo[t].addNewRoll(e)}openPlayerForm(){}}const c=class c{constructor(){s(this,"_isPaused",!1);s(this,"_globalForm");s(this,"_compareForm");s(this,"_importExportForm");s(this,"_settingsForm");s(this,"diceStatsPlayerMap",new Map);this._globalForm={},this._compareForm={},this._importExportForm={},this._settingsForm={}}static getInstance(){return(!c._instance||c._instance==null)&&(c._instance=new c),c._instance}loadPlayers(){let e=game==null?void 0:game.users,t=game.system.id;if(e)for(var r of e){let i=new V(r._id,r.name,r.isGM,t);this.diceStatsPlayerMap.set(r.name,i),this.diceStatsPlayerMap.set(r._id,i)}}parseRollMessage(e){}saveRollValue(e,t,r){if(!this._isPaused){var i=this.diceStatsPlayerMap.get(e);i==null||i.addRollData(r,t)}}openGlobalForm(e=!1){}openCompareForm(e=!1){}openImportExportForm(e=!1){}openSettingsForm(e=!1){var r,i;var t=game;(r=t.user)==null||r.isGM,(i=t.i18n)==null||i.localize("")}openPlayerForm(e="",t="",r=!1){var i,l;e?(i=this.diceStatsPlayerMap.get(e))==null||i.openPlayerForm():t&&((l=this.diceStatsPlayerMap.get(t))==null||l.openPlayerForm())}changePauseState(e=!1){return this._isPaused=!this._isPaused,this._isPaused}getIsPaused(){return this._isPaused}};s(c,"_instance");let u=c;const{ApplicationV2:B,DocumentSheetV2:X,HandlebarsApplicationMixin:j}=foundry.applications.api;var d,x;const m=class m extends j(B){constructor(e={}){super(e)}get title(){return"My Module: Dice Stats Module"}async _prepareContext(e){const t={};return t.customHeading="WOJO's Custom Heading",t}_onRender(e,t){var r;(r=this.element.querySelector("input[name=GenBtn]"))==null||r.addEventListener("click",m.refresh)}static async refresh(){await console.log("Dice Stats GenericApp On Refresh")}};d=new WeakSet,x=async function(e,t,r){console.log("Dice Stats GenericApp On Submit!")},D(m,d),s(m,"DEFAULT_OPTIONS",{tag:"form",form:{handler:k(m,d,x),submitOnChange:!1,closeOnSubmit:!1},position:{width:600,height:400}}),s(m,"PARTS",{form:{template:"modules/dice-stats/templates/genericTemplate.hbs"}});let S=m;var G,C;class q{constructor(){s(this,"name",((G=game.i18n)==null?void 0:G.localize("DiceStats.SceneControls.Settings.Name"))??"");s(this,"title",((C=game.i18n)==null?void 0:C.localize("DiceStats.SceneControls.Settings.Title"))??"");s(this,"icon","fa-solid fa-gears");s(this,"order",0);s(this,"visible",!0);s(this,"active",!1);s(this,"button",!0)}async onChange(e,t){u.getInstance().openSettingsForm(!0),new S().render()}}var b,M;class J{constructor(){s(this,"active",!1);s(this,"button",!0);s(this,"name",((b=game.i18n)==null?void 0:b.localize("DiceStats.SceneControls.GlobalStats.Name"))??"");s(this,"title",((M=game.i18n)==null?void 0:M.localize("DiceStats.SceneControls.GlobalStats.Title"))??"");s(this,"icon","fa-solid fa-earth-americas");s(this,"order",0);s(this,"visible",!0)}async onChange(e,t){u.getInstance().openGlobalForm()}}var w,F;class P{constructor(){s(this,"active",!1);s(this,"button",!0);s(this,"name",((w=game.i18n)==null?void 0:w.localize("DiceStats.SceneControls.CompareStats.Name"))??"");s(this,"title",((F=game.i18n)==null?void 0:F.localize("DiceStats.SceneControls.CompareStats.Title"))??"");s(this,"icon","fa-solid fa-users-line");s(this,"order",0);s(this,"visible",!0)}async onChange(e,t){u.getInstance().openCompareForm()}}const h=class h{constructor(e,t,r){s(this,"active",!1);s(this,"button",!0);s(this,"icon","");s(this,"name","");s(this,"order",0);s(this,"title","");s(this,"visible",!0);s(this,"associatedPlayerId","");var l,n;var i=((n=(l=game==null?void 0:game.users)==null?void 0:l.get(t))==null?void 0:n.isGM)??!1;this.name=e+"_name",this.title=e,this.associatedPlayerId=t,i?this.icon="fa-solid fa-book-open-reader":r?this.icon=r:this.icon="fas fa-dice-d20"}async onChange(e,t){h.app==null&&(h.app=new S),h.app.render(!0),h.app.bringToFront(),h.app.maximize()}};s(h,"app");let f=h;class $ extends SceneControls{constructor(t){super();s(this,"icon","fas fa-dice-d20");s(this,"name","dice-stats");s(this,"layer","diceStats");s(this,"visible",!0);s(this,"tools",{});s(this,"order",69);var r=0,i=new q;i.order=++r,this.tools[i.name]=i;var l=new J;l.order=++r,this.tools[l.name]=l;var n=new P;n.order=++r,this.tools[n.name]=n;for(var[U,O]of t){var g=new f(O,U,"fas fa-dice-d20");g.order=++r,this.tools[g.name]=g}}async onChange(t,r){}get title(){var t;return((t=game.i18n)==null?void 0:t.localize("DiceStats.SceneControls.DiceStatsSceneControl.Title"))??"Dice Stats"}get activeTool(){return""}}Hooks.once("init",()=>{console.log(`Initializing ${L}`),u.getInstance()});Hooks.once("ready",()=>{console.log("Scene Ready, We can load player data now!"),u.getInstance().loadPlayers()});Hooks.on("getSceneControlButtons",a=>{let e=[],t=["",""],r=game.users;if(r)for(let n of r)t[0]=n._id,t[1]=n.name,e.push(t);var i=new $(e);let l="dice-stats";a[l]=i});
//# sourceMappingURL=module.js.map
